# Context
 
*LoRa* is a low-power long-range wireless technology, developed by a French startup, later on bought 
by [Semtech](http://www.semtech.com/), a supplier of analog and mixed-signal semiconductor products. 
 
[Libelium](http://www.libelium.com/) is a Spanish company delivering an open source sensor platform 
for the Internet of Things.

Libelium added LoRa support to its offering some months ago. To start playing with LoRa, you simply 
have to use what Libelium names a *Plug & Sense* (mainly a waterproof case integrating a microcontroller 
board, several sensors and a wireless module, a LoRa one in our case) and their *LoRa gateway*, 
a USB stick that you can plug into a PC.

LoRa uses spread spectrum technology, on different channels. This means that the *Plug & Sense* and the 
*gateway* can be configured in several different ways, depending on parameters such as channel, 
bandwidth, coding rate and spreading factor. On *Plug & Sense* side, the developer can use the available 
software library. On *gateway* side, the developer has to send configuration messages to the USB stick 
using a terminal emulator. This is not very convenient.

# LoRa Gateway Controller

## Overview

This application implements a simple Libelium LoRa gateway controller: it allows to configure
various gateway parameters, and to read those parameters. Additionally, it displays messages
sent to the gateway by the *Plug & Sense*.

## User interface

The application user interface (UI) provides following elements:

* a serial port device selector
* a button to send **READ** frames
* a button to send **SET** frames
* several elements to define gateway parameters, used by the **SET** frame
* a first scrolling list
* a second scrolling list

More precisely:

* the top combo box allows to select the serial port to be used. Other buttons are active only 
once the serial port is selected. Once selected, it's no more possible to change the serial port.
* the **Send READ command** button sends the **READ** frame to the gateway. The gateway answers 
with its current configuration.
* the **Send SET command** sends the **SET** command to the gateway, with parameters set to 
the values selected on the right-hand side of the window: frequency and channel, address, 
bandwidth, coding rate and spreading factor.
* below those buttons, we have two scrolling lists of messages. The top one displays all frames 
received from the gateway. Those frames can be either answers to commands sent to the gateway, 
or data received from the *Plug & Sense*. Every message is timestamped.
* the bottom list displays messages generated by the applications. These messages inform the user 
about ongoing operations. In current version, following messages are displayed:
  *  at startup time: the list of available serial ports
  * mention of the use of the command buttons
  * frame sent by the use of a command button
  
## Discrepancies

Developing this type of application quite always leads to discovering some discrepancies between 
documentation and reality. In our case, we can list:

* frames received from the *Plug & Sense* are terminated by an undocumented sequence of two 
characters (*Carriage Return* and *Line Feed*)
* the gateway does not check the CRC of the command message it receives
* if a data frame sent by the *Plug & Sense* is received by the gateway almost at the same time 
a command is sent to it, format of data received by the PC is incorrect

## Limitations

The *Plug & Sense* can send two types of frames: ASCII frames and binary frames. In current version, 
only ASCII frames are supported.

# Installation

## Prerequisites

The Libelium LoRa Gateway Controller uses the [RXTX library](http://rxtx.qbang.org/wiki/index.php/Main_Page) 
to access the serial port. You have to install it in order to be able to run the application. 
For installation procedure, please refer to [this page](http://rxtx.qbang.org/wiki/index.php/Installation).

UI source code relies on [JavaFX](https://docs.oracle.com/javase/8/javafx/get-started-tutorial/jfx-architecture.htm#CHDFDAFF).  

## Installation

For a PC running *Linux Mint*, for instance, one possible way to run the application is:

- install package `librxtx-java` (version `2.2pre2-11`)
- add `RXTXcomm.jar` to `CLASSPATH`:

```
export CLASSPATH=$CLASSPATH:/usr/share/java/RXTXcomm.jar
```

- add `librxtxSerial.so` to `LD_LIBRARY_PATH`:

```
export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/lib/jni/
```

- run `LibeliumGateway.jar` file:

```
java -jar LibeliumGateway.jar
```
    
To rebuild the application from source code, again refer to [RXTX wiki](http://rxtx.qbang.org/wiki/index.php/Main_Page) 
and to [JavaFX documentation](https://docs.oracle.com/javase/8/javase-clienttechnologies.htm).

For *Eclipse*, for instance:

- configure Eclipse for JavaFX, as explained [here](http://www.eclipse.org/efxclipse/install.html#for-the-lazy)
- download [Scene Builder](http://docs.oracle.com/javase/8/scene-builder-2/user-guide/index.html) from 
[here](http://gluonhq.com/open-source/scene-builder/). Then, in Eclipse, set the path 
to Scene Builder executable (**Window / Preferences / JavaFX**)
- install package `librxtx-java` (version `2.2pre2-11`)
- add `/usr/share/java/RXTXcomm-2.2pre2.jar` external JAR to the Eclipse project
- right-click on the jar in the list of referenced libraries in the Eclipse project, 
select **Properties / Native Library** and enter the directory containing native libraries: 
`/usr/lib/jni`